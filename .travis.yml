---

language: python

sudo: required

env:
  - distribution: centos
    version:      latest
  - distribution: centos
    version:      8
  - distribution: centos
    version:      7
  - distribution: debian
    version:      sid
  - distribution: debian
    version:      buster
  - distribution: debian
    version:      buster-slim
  - distribution: debian
    version:      stretch
  - distribution: debian
    version:      jessie
  - distribution: debian
    version:      sid
  - distribution: fedora
    version:      rawhide
  - distribution: fedora
    version:      33
  - distribution: fedora
    version:      32
  - distribution: fedora
    version:      31
  - distribution: fedora
    version:      30
  - distribution: fedora
    version:      29
  - distribution: richxsl/rhel7
    version:      latest
  - distribution: ubuntu
    version:      rolling
  - distribution: ubuntu
    version:      focal
  - distribution: ubuntu
    version:      bionic
  - distribution: ubuntu
    version:      xenial
  - distribution: ubuntu
    version:      trusty

services:
  - docker

before_install:
  - 'sudo docker pull ${distribution}:${version}'

script:
  - container_id=$(mktemp -t XXXXXXXXXXXX)
  - container_id=$( basename $container_id )
  - 'docker run --detach --volume="$PWD":"$PWD":ro -w "$PWD" --name $container_id $distribution:$version sleep 2d'
  - 'docker exec -it $container_id sh -c "cd tests && pwd && ls -ld ./* ../* ../../* ../../../*" || true'
  - 'docker exec -it $container_id ./tests/env-prep.sh'
  - 'docker exec -it $container_id sh -c "cd tests && ./test.yml -l localhost -vv"'

notifications:
  webhooks: https://galaxy.ansible.com/api/v1/notifications/
